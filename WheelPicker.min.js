/*
    WheelPickerJS
    written by JinHo-Dev
    https://github.com/JinHo-Dev/WheelPickerJS
*/
let WheelPickerPreset={};class WheelPicker{drawAll(){for(let a=0;a<this.lists.length;a++)this.draw(a)}draw(a){const b=this.boundaries[a],c=this.boundaries[a+1],d=Math.round(b*this.dpi),e=Math.round(c*this.dpi);this.plane.clearRect(d,0,e-d,this.HEIGHT),this.write(a),this.roll(a)}write(a){let b=this.dpi,c=this.lists[a].length,d=32*c,e=this.papyrusDOM[a],f=this.scrollTop[a];if(1==this.infinites[a]){f+=96,0>f?f=f%d+d:0<f&&(f%=d),f-=96;for(let d=1;0>f+32+32*(d-1)*c;d++)e.height<=32*b+1&&1==d?this.plane.drawImage(e,0,0,e.width,e.height,this.boundaries[a]*b,(-f-64)*b,e.width,32*b):this.plane.drawImage(e,0,e.height*d+(f+32)*b,e.width,(-f-32)*b,this.boundaries[a]*b,0,e.width,(-f-32)*b);for(let d=1;32>32*(d-1)*c-f-128;d++)this.plane.drawImage(e,0,0,e.width,-d*e.height+(f+192)*b,this.boundaries[a]*b,d*e.height-(f+32)*b,e.width,-d*e.height+(f+192)*b)}let g=(f+32)*b;0>g?this.plane.drawImage(e,0,0,e.width,this.HEIGHT,this.boundaries[a]*b,-g,e.width,this.HEIGHT):this.plane.drawImage(e,0,g,e.width,this.HEIGHT,this.boundaries[a]*b,0,e.width,this.HEIGHT)}roll(a){const b=this.boundaries[a],c=this.boundaries[a+1],d=Math.round(b*this.dpi),e=Math.round(c*this.dpi);this.linen.clearRect(d,0,e-d,this.HEIGHT),this.circular.clearRect(d,0,e-d,this.HEIGHT);let f=Array(this.HEIGHT);for(let b=0;b<this.HEIGHT;b++){let a=this.fn[b],c=Math.round(this.HEIGHT/2+(.2*a+.8)*(b-this.HEIGHT/2));if(1==f[c])continue;else if(c<96*this.dpi&&c>64*this.dpi)continue;else f[c]=1;let g=Math.round(this.WIDTH/2+(.05*a+.95)*(d-this.WIDTH/2)),h=Math.round(this.WIDTH/2+(.05*a+.95)*(e-this.WIDTH/2));this.linen.globalAlpha=.4*a,this.linen.drawImage(this.planeDOM,d,b,e-d,1,g,c,h-g,1)}this.linen.globalAlpha=1,this.linen.drawImage(this.planeDOM,d,64*this.dpi,e-d,32*this.dpi,d,64*this.dpi,e-d,32*this.dpi),this.linen.fillStyle=140<this.background.split(",")[0].split("(")[1]?"rgba(0,0,10,0.3)":"rgba(255,255,255,0.3)",this.linen.fillRect(d,Math.round(64*this.dpi),e-d,1),this.linen.fillRect(d,Math.round(96*this.dpi-1),e-d,1),this.circular.drawImage(this.linenDOM,d,0,e-d,this.HEIGHT,d,0,e-d,this.HEIGHT)}constructor(a){this.parent=a,this.timeNpos=[[0,0],[0,0]];let b=a.getElementsByTagName("select");this.selectDOMs=b,this.lists=Array(b.length),this.interv=Array(b.length),this.lastTime=Array(b.length),this.accel=333,this.selecteds=Array(b.length),this.infinites=Array(b.length);for(let c=0;c<b.length;c++){b[c].addEventListener("change",function(a){let b=a.target.closest("div").WheelPicker;b.selecteds[c]=this.selectedIndex,b.scrollTop[c]=32*b.selecteds[c]-96,b.draw(c)});let a=b[c].getElementsByTagName("option");this.lists[c]=Array(a.length);for(let b=0;b<a.length;b++)this.lists[c][b]=a[b].innerText;b[c].style.display="none"}this.dpi=window.devicePixelRatio,this.scrollTop=Array(this.lists.length),this.width=a.offsetWidth,this.height=160,this.WIDTH=Math.round(this.width*this.dpi),this.HEIGHT=Math.round(this.height*this.dpi),this.fn=Array(this.HEIGHT);for(var c=0;c<this.HEIGHT;c++)this.fn[c]=Math.sin(Math.PI/2*c/this.dpi/80);this.planeDOM=document.createElement("canvas"),this.plane=this.planeDOM.getContext("2d",{willReadFrequently:!1,antialias:!1}),this.planeDOM.width=this.WIDTH,this.planeDOM.height=this.HEIGHT,this.planeDOM.style.imageRendering="pixelated",this.linenDOM=document.createElement("canvas"),this.linen=this.linenDOM.getContext("2d",{willReadFrequently:!1,antialias:!1}),this.linenDOM.width=this.WIDTH,this.linenDOM.height=this.HEIGHT,this.linenDOM.style.imageRendering="pixelated",this.circularDOM=document.createElement("canvas"),a.appendChild(this.circularDOM),this.circular=this.circularDOM.getContext("2d",{willReadFrequently:!1,antialias:!1}),this.circularDOM.style.width=this.width+"px",this.circularDOM.width=this.WIDTH,this.circularDOM.style.height=this.height+"px",this.circularDOM.height=this.HEIGHT,this.circularDOM.imageSmoothingEnabled=!1,this.circularDOM.style.imageRendering="pixelated",this.tDOM=document.createElement("div"),this.tDOM.style.position="absolute",this.tDOM.style.width="auto",this.tDOM.style.height="auto",this.tDOM.style.visibility="hidden",this.tDOM.style.whiteSpace="nowrap",this.tDOM.style.fontSize="22px",a.appendChild(this.tDOM),this.boundaries=[0];let d=0;for(let b,c=0;c<this.lists.length;c++){b=0;for(let a=0;a<this.lists[c].length;a++)this.tDOM.innerText=this.lists[c][a],b=Math.max(b,this.tDOM.clientWidth);d+=b+32,this.boundaries.push(d)}a.removeChild(this.tDOM),d=(this.width-d)/2;for(let b=0;b<this.boundaries.length;b++)this.boundaries[b]+=d;this.papyrusDOM=Array(this.lists.length),this.papyrus=Array(this.lists.length);for(let b=0;b<this.lists.length;b++)this.papyrusDOM[b]=document.createElement("canvas"),this.papyrus[b]=this.papyrusDOM[b].getContext("2d",{willReadFrequently:!1,antialias:!1}),this.papyrusDOM[b].width=Math.round((this.boundaries[b+1]-this.boundaries[b])*this.dpi),this.papyrusDOM[b].style.imageRendering="pixelated";let f;a.addEventListener("wheel",function(a){a.preventDefault(),a.stopImmediatePropagation();let b=this.getBoundingClientRect();this.WheelPicker.scroll(a.clientX-b.left,32*(a.deltaY/125)/2),f=clearTimeout(f),f=setTimeout(()=>{for(let a=0;a<this.WheelPicker.scrollTop.length;a++)this.WheelPicker.adj(this.WheelPicker.boundaries[a+1])},400)}),this.isClick=0,a.WheelPicker=this,this.reloadAll()}reloadAll(){this.color=window.getComputedStyle(this.parent).color,this.background=window.getComputedStyle(this.parent).backgroundColor,this.circular.clearRect(Math.round(10*this.dpi),64*this.dpi,Math.round(this.WIDTH-20*this.dpi),1),this.circular.clearRect(Math.round(10*this.dpi),Math.round(96*this.dpi-1),Math.round(this.WIDTH-20*this.dpi),1),this.circular.fillStyle=140<this.background.split(",")[0].split("(")[1]?"rgba(0,0,10,0.3)":"rgba(255,255,255,0.3)",this.circular.fillRect(Math.round(10*this.dpi),64*this.dpi,Math.round(this.WIDTH-20*this.dpi),1),this.circular.fillRect(Math.round(10*this.dpi),Math.round(96*this.dpi-1),Math.round(this.WIDTH-20*this.dpi),1);for(let a=0;a<this.lists.length;a++)this.reload(a)}reload(a){let b=this.parent.getElementsByTagName("select")[a],c=b.getElementsByTagName("option");this.infinites[a]=0,this.infinites[a]=null==b.getAttribute("infinite")?0:1,this.lists[a]=Array(c.length);for(let b=0;b<c.length;b++)this.lists[a][b]=c[b].innerText;this.selecteds[a]=b.selectedIndex,this.scrollTop[a]=32*this.selecteds[a]-96,this.papyrusDOM[a].height=Math.round(32*this.dpi*this.lists[a].length),this.papyrus[a].font=`${window.getComputedStyle(this.parent).fontWeight} ${Math.round(22*this.dpi)}px ${window.getComputedStyle(this.parent).fontFamily}`,this.papyrus[a].textBaseline="center",this.papyrus[a].fillStyle=this.color,this.papyrus[a].textAlign="center";let d=(this.boundaries[a+1]-this.boundaries[a])/2*this.dpi;for(let b=0;b<this.lists[a].length;b++)this.papyrus[a].fillText(this.lists[a][b],Math.round(d),Math.round((-8+32*b+32)*this.dpi));this.draw(a)}setNth(a){let b=this.boundaries.length-2;for(let c=1;c<this.boundaries.length;c++)if(this.boundaries[c]>=a){b=c-1;break}this.nth=b}scroll(a,b){let c;if(-1==a)c=this.nth;else{c=this.boundaries.length-2;for(let b=1;b<this.boundaries.length;b++)if(this.boundaries[b]>=a){c=b-1;break}}this.scrollTop[c]+=b,this.draw(c)}goto(a,b){let e;if(-1==a)e=this.nth;else{e=this.boundaries.length-2;for(let b=1;b<this.boundaries.length;b++)if(this.boundaries[b]>=a){e=b-1;break}}let f;f=0==this.infinites[e]&&0>this.selecteds[e]+b?-96:0==this.infinites[e]&&this.selecteds[e]+b>=this.lists[e].length?32*(this.lists[e].length-1)-96:32*(this.selecteds[e]+b)-96,f-=this.scrollTop[e];let g=this.scrollTop[e];this.interv[e]=clearInterval(this.interv[e]),this.lastTime[e]=new Date-0,this.interv[e]=setInterval(()=>{let a=(new Date-this.lastTime[e])/1e3;if(0>=a&&(a=.001),.1>a)this.scrollTop[e]=g+10*(f*a),this.draw(e);else{this.interv[e]=clearInterval(this.interv[e]);let a=(96+g+f)/32;a=(this.lists[e].length+a%this.lists[e].length)%this.lists[e].length,this.selecteds[e]=a,this.selectDOMs[e].selectedIndex=a;let b=document.createEvent("HTMLEvents");b.initEvent("change",!1,!0),this.selectDOMs[e].dispatchEvent(b),this.scrollTop[e]=32*a-96,this.draw(e)}},1)}stop(a){let b;if(-1==a)b=this.nth;else{b=this.boundaries.length-2;for(let c=1;c<this.boundaries.length;c++)if(this.boundaries[c]>=a){b=c-1;break}}this.interv[b]=clearInterval(this.interv[b])}adj(a){let b;if(-1==a)b=this.nth;else{b=this.boundaries.length-2;for(let c=1;c<this.boundaries.length;c++)if(this.boundaries[c]>=a){b=c-1;break}}let e=this.scrollTop[b],c=(32+e%32)%32;16<=c&&(c-=32),-96>=e&&0==this.infinites[b]&&(c=e+96),e>=32*this.lists[b].length-128&&0==this.infinites[b]&&(c=e-32*this.lists[b].length+128),this.interv[b]=clearInterval(this.interv[b]),this.lastTime[b]=new Date-0,this.interv[b]=setInterval(()=>{let a=(new Date-this.lastTime[b])/1e3;if(0>=a&&(a=.001),.1>a)this.scrollTop[b]=e-10*(c*a),this.draw(b);else{this.interv[b]=clearInterval(this.interv[b]);let a=(96+e-c)/32;a=(this.lists[b].length+a%this.lists[b].length)%this.lists[b].length,this.selecteds[b]=a,this.selectDOMs[b].selectedIndex=a;let d=document.createEvent("HTMLEvents");d.initEvent("change",!1,!0),this.selectDOMs[b].dispatchEvent(d),this.scrollTop[b]=32*a-96,this.draw(b)}},1)}initScroll(a,b){let c;if(-1==a)c=this.nth;else{c=this.boundaries.length-2;for(let b=1;b<this.boundaries.length;b++)if(this.boundaries[b]>=a){c=b-1;break}}this.lastTime[c]=new Date-0,this.interv[c]=clearInterval(this.interv[c]),this.interv[c]=setInterval(()=>{let a=(new Date-this.lastTime[c])/1e3;this.lastTime[c]=new Date-0,0>=a&&(a=.001),0<b?(this.scrollTop[c]+=-b*a,this.draw(c),b-=-96>this.scrollTop[c]&&0==this.infinites[c]?this.accel*((-this.scrollTop[c]-96)/2+1)*a:this.accel*a,0>b&&(b=0)):0>b?(this.scrollTop[c]+=-b*a,this.draw(c),b+=this.scrollTop[c]>32*this.lists[c].length-128&&0==this.infinites[c]?this.accel*((this.scrollTop[c]-32*this.lists[c].length+128)/2+1)*a:this.accel*a,0<b&&(b=0)):0==b&&(this.interv[c]=clearInterval(this.interv[c]),this.adj(this.boundaries[c+1]))},1)}pointerStart(a,b){let c=this.parent.getBoundingClientRect();this.setNth(a-c.left),this.timeNpos=[[new Date-0,b],[new Date-0,b]],this.interv[this.nth]==null?(this.isClick=1,this.firstX=a,this.firstY=b):this.stop(-1)}pointerMove(a,b){this.scroll(-1,this.timeNpos[1][1]-b),this.timeNpos[0][1]=this.timeNpos[1][1],this.timeNpos[1][1]=b,this.timeNpos[0][0]=this.timeNpos[1][0],this.timeNpos[1][0]=new Date-0,20<(this.firstX-a)*(this.firstX-a)+(this.firstY-b)*(this.firstY-b)&&(this.isClick=0)}pointerEnd(){if(1==this.isClick){let a=this.parent.getBoundingClientRect();if(0==this.isClick)return;let b=this.firstY-a.top;36>b?this.goto(-1,-2):64>b?this.goto(-1,-1):124<=b?this.goto(-1,2):96<=b&&this.goto(-1,1)}else{let a;a=this.timeNpos[0][0]==this.timeNpos[1][0]?0:1e3*((this.timeNpos[0][1]-this.timeNpos[1][1])/(this.timeNpos[0][0]-this.timeNpos[1][0])),220>Math.abs(a)?this.adj(-1):this.initScroll(-1,Math.max(Math.min(a,1e3),-1e3))}}}let eventAvailable=!1;async function WheelPickerStart(){let a=document.querySelectorAll(".WheelPicker");for(let b=0;b<a.length;b++){if(a[b].WheelPicker)continue;a[b].hasAttribute("preset")&&(a[b].innerHTML=WheelPickerPreset[a[b].getAttribute("preset")]);let c=a[b].querySelectorAll("option"),d="";for(let a=0;a<c.length;a++)d+=c[a].innerText;a[b].innerHTML+=`<font style='position:absolute;width:1px;height:1px;opacity:0;overflow:hidden;'>${d}</font>`}document.fonts&&(await document.fonts.ready);for(let b=0;b<a.length;b++)a[b].WheelPicker||(a[b].removeChild(a[b].querySelector("font")),new WheelPicker(a[b]));let b;eventAvailable||(eventAvailable=!0,window.addEventListener("mousedown",function(a){let c=a.target.closest("div");c&&"WheelPicker"==c.className&&(a.preventDefault(),a.stopImmediatePropagation(),b=c.WheelPicker,b.pointerStart(a.clientX,a.clientY))}),window.addEventListener("touchstart",function(a){let c=a.target.closest("div");c&&"WheelPicker"==c.className&&(a.preventDefault(),a.stopImmediatePropagation(),b=c.WheelPicker,b.pointerStart(a.touches[0].clientX,a.touches[0].clientY))},{passive:!1}),window.addEventListener("mousemove",function(a){null!=b&&(a.preventDefault(),a.stopImmediatePropagation(),b.pointerMove(a.clientX,a.clientY))}),window.addEventListener("touchmove",function(a){null!=b&&(a.preventDefault(),a.stopImmediatePropagation(),b.pointerMove(a.touches[0].clientX,a.touches[0].clientY))},{passive:!1}),window.addEventListener("mouseup",function(a){null!=b&&(a.preventDefault(),a.stopImmediatePropagation(),b.pointerEnd(),b=null)}),window.addEventListener("touchend",function(a){null!=b&&(a.preventDefault(),a.stopImmediatePropagation(),b.pointerEnd(),b=null)}))}